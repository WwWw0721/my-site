<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>麻將計算機</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .app { max-width: 760px; margin: 0 auto; }
    .row { display:flex; gap:10px; flex-wrap: wrap; align-items: center; }
    .row > * { flex: 1 1 160px; }

    label { display:block; font-size: 13px; color: rgba(232,238,252,.75); margin: 2px 0 6px; }
    select, input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: #e8eefc;
      outline: none;
    }
    input::placeholder { color: rgba(232,238,252,.35); }

    .actions { display:flex; gap:10px; flex-wrap: wrap; margin-top: 10px; }
    .btn2 {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: #e8eefc;
      cursor: pointer;
      user-select: none;
      text-decoration: none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }
    .btn2:hover { border-color: rgba(255,255,255,.30); }
    .btn2.primary { background: rgba(110,168,254,.14); }
    .btn2.danger { background: rgba(255,80,80,.12); }

    .chips { display:flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
    .chip {
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(232,238,252,.9);
      cursor: pointer;
      user-select: none;
      font-size: 14px;
    }
    .chip:hover { border-color: rgba(255,255,255,.30); }

    table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    th, td {
      border-bottom: 1px solid rgba(255,255,255,.12);
      padding: 10px 6px;
      text-align: left;
      font-size: 14px;
    }
    th { color: rgba(232,238,252,.75); font-weight: 600; }
    .pos { color: #9fe8a7; }
    .neg { color: #ffb0b0; }
    .muted { color: rgba(232,238,252,.65); }

    .history {
      margin-top: 12px;
      max-height: 260px;
      overflow: auto;
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      padding: 10px;
      background: rgba(0,0,0,.12);
    }
    .hitem { padding: 8px 6px; border-bottom: 1px dashed rgba(255,255,255,.12); }
    .hitem:last-child { border-bottom: none; }
    .small { font-size: 12px; color: rgba(232,238,252,.60); margin-top: 6px; }
  </style>
</head>
<body>
  <nav>
    <div class="container nav-inner">
      <div class="brand">MySite</div>
      <div class="nav-links">
        <a href="index.html">首頁</a>
        <a href="about.html">菜翔翔</a>
        <a href="projects.html">麻將計算機</a>
      </div>
    </div>
  </nav>

  <main class="container">
    <section class="hero">
      <h1>麻將計算機</h1>
      <p>麻將計算機</p>
    </section>

    <section class="grid">
      <div class="card app">
        <div class="row">
          <div>
            <label>付款者（A要給B → A 是付款者）</label>
            <select id="payer"></select>
          </div>
          <div>
            <label>收款者（A要給B → B 是收款者）</label>
            <select id="receiver"></select>
          </div>
          <div>
            <label>金額</label>
            <input id="amount" type="number" inputmode="numeric" placeholder="例如 10 或 30" min="1" />
          </div>
        </div>

        <div class="chips" aria-label="快速金額">
          <span class="chip" data-amt="10">+10</span>
          <span class="chip" data-amt="30">+30</span>
        </div>

        <div class="actions">
          <button class="btn2 primary" id="add">新增紀錄</button>
          <button class="btn2" id="undo">復原上一步</button>
          <button class="btn2 danger" id="reset">全部重置</button>
        </div>

        <div class="small" id="hint"></div>

        <h3 style="margin:16px 0 6px;">目前差額</h3>
        <table>
          <thead>
            <tr>
              <th>玩家</th>
              <th>差額（+代表贏/收，-代表輸/付）</th>
            </tr>
          </thead>
          <tbody id="score"></tbody>
        </table>

        <h3 style="margin:16px 0 6px;">紀錄</h3>
        <div class="history" id="history"></div>
        <div class="small">提示：你也可以直接用鍵盤輸入金額，然後按「新增紀錄」。</div>
      </div>
    </section>
  </main>

  <footer>© <span id="y"></span> MySite
    <script>document.getElementById("y").textContent = new Date().getFullYear();</script>
  </footer>

  <script>
    const PLAYERS = ["A", "B", "C", "D"];
    const payerSel = document.getElementById("payer");
    const receiverSel = document.getElementById("receiver");
    const amountInp = document.getElementById("amount");
    const hint = document.getElementById("hint");
    const scoreBody = document.getElementById("score");
    const historyBox = document.getElementById("history");

    const KEY = "mahjong_chip_calc_v1";

    function defaultState() {
      const balances = {};
      PLAYERS.forEach(p => balances[p] = 0);
      return { balances, history: [] };
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(KEY);
        if (!raw) return defaultState();
        const obj = JSON.parse(raw);
        if (!obj || !obj.balances || !obj.history) return defaultState();
        return obj;
      } catch { return defaultState(); }
    }

    function saveState() {
      localStorage.setItem(KEY, JSON.stringify(state));
    }

    let state = loadState();

    function renderSelects() {
      const makeOptions = () => PLAYERS.map(p => `<option value="${p}">${p}</option>`).join("");
      payerSel.innerHTML = makeOptions();
      receiverSel.innerHTML = makeOptions();
      payerSel.value = "A";
      receiverSel.value = "B";
    }

    function fmt(n) {
      const sign = n > 0 ? "+" : "";
      return sign + n;
    }

    function renderScores() {
      scoreBody.innerHTML = PLAYERS.map(p => {
        const v = state.balances[p] || 0;
        const cls = v > 0 ? "pos"
